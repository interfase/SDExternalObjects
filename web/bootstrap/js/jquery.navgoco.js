(function(c){var b=function(f,e,d){this.el=f;this.$el=c(f);this.options=e;this.uuid=this.$el.attr("id")?this.$el.attr("id"):d;this.state={};this.init();return this};b.prototype={init:function(){var e=this;e._load();e.$el.find("ul").each(function(h){var i=c(this);i.attr("data-index",h);if(e.options.save&&e.state.hasOwnProperty(h)){i.parent().addClass(e.options.openClass);i.show()}else{if(i.parent().hasClass(e.options.openClass)){i.show();e.state[h]=1}else{i.hide()}}});var g=c("<span></span>").prepend(e.options.caretHtml);var d=e.$el.find("li:has(ul) > a");var f=d.filter(function(){var h=c(this).attr("href");return h===undefined||h===""||h==="#"});e._trigger(g,false);e._trigger(f,true);d.prepend(g)},_trigger:function(e,f){var d=this;e.on("click",function(h){h.stopPropagation();var g=f?c(this).next():c(this).parent().next();g=g.length>0?g:false;d.options.onClickBefore.call(this,h,g);if(g){h.preventDefault();d._toggle(g,g.is(":hidden"));d._save()}else{if(d.options.accordion){var i=d.state=d._parents(c(this));d.$el.find("ul").filter(":visible").each(function(){var k=c(this),j=k.attr("data-index");if(!i.hasOwnProperty(j)){d._toggle(k,false)}});d._save()}}d.options.onClickAfter.call(this,h,g)})},_toggle:function(h,f){var e=this,d=h.attr("data-index"),g=h.parent();e.options.onToggleBefore.call(this,h,f);if(f){g.addClass(e.options.openClass);h.slideDown(e.options.slide);e.state[d]=1;if(e.options.accordion){var i=e.state=e._parents(h);i[d]=e.state[d]=1;e.$el.find("ul").filter(":visible").each(function(){var k=c(this),j=k.attr("data-index");if(!i.hasOwnProperty(j)){e._toggle(k,false)}})}}else{g.removeClass(e.options.openClass);h.slideUp(e.options.slide);e.state[d]=0}e.options.onToggleAfter.call(this,h,f)},_parents:function(g,h){var d={},f=g.parent(),e=f.parents("ul");e.each(function(){var j=c(this),i=j.attr("data-index");if(!i){return false}d[i]=h?j:1});return d},_save:function(){if(this.options.save){var e={};for(var d in this.state){if(this.state[d]===1){e[d]=1}}a[this.uuid]=this.state=e;c.cookie(this.options.cookie.name,JSON.stringify(a),this.options.cookie)}},_load:function(){if(this.options.save){if(a===null){var d=c.cookie(this.options.cookie.name);a=(d)?JSON.parse(d):{}}this.state=a.hasOwnProperty(this.uuid)?a[this.uuid]:{}}},toggle:function(g){var n=this,e=arguments.length;if(e<=1){n.$el.find("ul").each(function(){var i=c(this);n._toggle(i,g)})}else{var m,h={},k=Array.prototype.slice.call(arguments,1);e--;for(var f=0;f<e;f++){m=k[f];var d=n.$el.find('ul[data-index="'+m+'"]').first();if(d){h[m]=d;if(g){var l=n._parents(d,true);for(var j in l){if(!h.hasOwnProperty(j)){h[j]=l[j]}}}}}for(m in h){n._toggle(h[m],g)}}n._save()},destroy:function(){c.removeData(this.$el);this.$el.find("li:has(ul) > a").unbind("click");this.$el.find("li:has(ul) > a > span").unbind("click")}};c.fn.navgoco=function(e){if(typeof e==="string"&&e.charAt(0)!=="_"&&e!=="init"){var f=true,d=Array.prototype.slice.call(arguments,1)}else{e=c.extend({},c.fn.navgoco.defaults,e||{});if(!c.cookie){e.save=false}}return this.each(function(g){var i=c(this),h=i.data("navgoco");if(!h){h=new b(this,f?c.fn.navgoco.defaults:e,g);i.data("navgoco",h)}if(f){h[e].apply(h,d)}})};var a=null;c.fn.navgoco.defaults={caretHtml:"",accordion:false,openClass:"open",save:true,cookie:{name:"navgoco",expires:false,path:"/"},slide:{duration:400,easing:"swing"},onClickBefore:c.noop,onClickAfter:c.noop,onToggleBefore:c.noop,onToggleAfter:c.noop}})(jQuery);